<!DOCTYPE HTML>
<html><head><meta charset="UTF-8"><title>Main</title><style type="text/css">html,head,body { padding:0; margin:0; }body { font-family: helvetica, arial, sans-serif; }</style></head><body><script type="text/javascript" src="..\lib\elm-runtime.js"></script>
<!-- <script src="http://code.jquery.com/jquery-1.7.1.min.js" language="javascript"></script> -->
<script src="..\lib\faustui.js"></script>
<script type="text/javascript">
<!-- Faust -->
function square_wave() {

  this.iRec0 = new Int32Array(2);
  this.fhslider0;
  this.fhslider1;
  this.fSamplingFreq;

  this.metadata = function(m) {
  }

  this.getNumInputs = function() { return 0; }
  this.getNumOutputs = function() { return 1; }

  this.classInit = function(samplingFreq) {
  }

  this.instanceInit = function(samplingFreq) {
    this.fSamplingFreq = samplingFreq;
    this.fhslider0 = 1;
    for (var i = 0; (i < 2); i = (i + 1)) {
      this.iRec0[i] = 0;

    }
    this.fhslider1 = 0.5;

  }

  this.init = function(samplingFreq) {
    this.classInit(samplingFreq);
    this.instanceInit(samplingFreq);
  }

  this.buildUserInterface = function(ui_interface) {
    // ui_interface.openVerticalBox("square");
    // ui_interface.addHorizontalSlider("Cyclic ratio", function handler(obj) { function setval(val) { obj.fhslider1 = val; } return setval; }(this), 0.5, 0, 1, 0.1);
    // ui_interface.addHorizontalSlider("Period", function handler(obj) { function setval(val) { obj.fhslider0 = val; } return setval; }(this), 1, 0.1, 100, 0.1);
    // ui_interface.closeBox();

  }

  this.compute = function(count, inputs, outputs) {
    var output0 = outputs[0];
    var iSlow0 = (44.1 * this.fhslider0);
    var fSlow1 = (this.fhslider1 * iSlow0);
    for (var i = 0; (i < count); i = (i + 1)) {
      this.iRec0[0] = (1 + (this.iRec0[1] % iSlow0));
      output0[i] = ((2 * ((this.iRec0[0] - 1) < fSlow1)) - 1);
      this.iRec0[1] = this.iRec0[0];

    }

  }

}


<!-- WebAudio API -->

process_square_wave = function(obj)
{
    function process_aux_square_wave(event)
    {
        var count;

        /*
        if (event.inputBuffer.numberOfChannels < dsp.getNumInputs()) {
            console.log("Incorrect number of input %d instead of %d", event.inputBuffer.numberOfChannels, dsp.getNumInputs());
            return;
        }
        */

        if (event.outputBuffer.numberOfChannels < obj.dsp.getNumOutputs()) {
            console.log("Incorrect number of output %d instead of %d", event.outputBuffer.numberOfChannels, obj.dsp.getNumOutputs());
            return;
        }

        for (var i = 0; i < obj.dsp.getNumInputs(); i++) {
            obj.inputs[i] = event.inputBuffer.getChannelData(i);
            if (obj.inputs[i] != null) {
                count = obj.inputs[i].length;
            }
        }

        for (var i = 0; i < obj.dsp.getNumOutputs(); i++) {
            obj.outputs[i] = event.outputBuffer.getChannelData(i);
            if (obj.outputs[i] != null) {
                count = obj.outputs[i].length;
            }
        }

        obj.dsp.compute(count, obj.inputs, obj.outputs);

    }
    return process_aux_square_wave;
}

function create_square_wave(audio_context, user_interface, meta_interface, buffer_size)
{
    this.dsp = new square_wave();

    this.dsp.init(audio_context.sampleRate);
    this.dsp.buildUserInterface(user_interface);
    this.dsp.metadata(meta_interface);

    this.inputs = new Array(this.dsp.getNumInputs());
    this.outputs = new Array(this.dsp.getNumOutputs());

    console.log(audio_context.sampleRate);
    console.log(this.dsp.getNumInputs());
    console.log(this.dsp.getNumOutputs());

    this.processor = audio_context.createJavaScriptNode(buffer_size, this.dsp.getNumInputs(), this.dsp.getNumOutputs());
    this.processor.onaudioprocess = process_square_wave(this);

    return this;
}

var context;
var ui;
var meta;
var source;
var faustdsp;

function initAudio(buffer_size)
{
    context = new webkitAudioContext();

    ui = new JUI(document.getElementById("41"));

    faustdsp = new create_square_wave(context, ui, meta, buffer_size);
    faustdsp.processor.connect(context.destination);
}

<!-- /Faust -->

gol = [];
document.body.onload = function() {
    initAudio(4096);

    var e = document.createEvent('Event');
    e.initEvent('provideHost', true, true);
    e.value = window.location.host;
    document.dispatchEvent(e);

    var presetSn = window.location.pathname.match(/\/preset\/(.*)/);
    if (presetSn != null){
    	e = document.createEvent('Event');
	    e.initEvent('providePresetUrl', true, true);
	    e.value = "http://" + window.location.host + "/api" + presetSn[0];
	    document.dispatchEvent(e);
    }

    document.addEventListener('onGolStep', function(e) {
        gol = e.value;
        faustdsp.dsp.fhslider0 = gol.length;
    });
}
try{

if (Elm.GameOfLife) throw "Module name collision, 'GameOfLife' is already defined.";
Elm.GameOfLife=function(){
 var $op={};
 for(Elm['i'] in Elm){eval('var '+Elm['i']+'=Elm[Elm.i];');}
 try{
  if (!(Elm.Prelude instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'Prelude' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var hiddenVars={};
 for (Elm['i'] in Elm.Prelude) {
  if (hiddenVars[Elm['i']]) continue;
  eval('var ' + Elm['i'] + ' = Elm.Prelude[Elm.i];');}
 function countNghb_7(Tuple2$xy_10){
  return function(gof_11){
   return function(){
   switch(Tuple2$xy_10[0]){
    case 'Tuple2':
    return length(filter(function(Tuple2$nxny_14){
     return function(){
     switch(Tuple2$nxny_14[0]){
      case 'Tuple2':
      return alive_0(['Tuple2',(Tuple2$xy_10[1]+Tuple2$nxny_14[1]),(Tuple2$xy_10[2]+Tuple2$nxny_14[2])])(gof_11);
     }
     throw "Non-exhaustive pattern match in case";}();})(adjacentOffsets_6));
   }
   throw "Non-exhaustive pattern match in case";}();};}
 function emptyNghb_8(Tuple2$xy_17){
  return function(gof_18){
   return function(){
   switch(Tuple2$xy_17[0]){
    case 'Tuple2':
    return filter(function(x){
     return not(flip(alive_0)(gof_18)(x));})(map(function(Tuple2$nxny_21){
     return function(){
     switch(Tuple2$nxny_21[0]){
      case 'Tuple2':
      return ['Tuple2',(Tuple2$xy_17[1]+Tuple2$nxny_21[1]),(Tuple2$xy_17[2]+Tuple2$nxny_21[2])];
     }
     throw "Non-exhaustive pattern match in case";}();})(adjacentOffsets_6));
   }
   throw "Non-exhaustive pattern match in case";}();};}
 function step_9(initGof_24){
  return function(){
   var emptyCells_26=fromList_2(concatMap(flip(emptyNghb_8)(initGof_24))(toList_3(initGof_24)));
   var survived_27=Set.foldl(function(cell_32){
    return function(gof__33){
     return (survives_25(cell_32)(initGof_24)?insert_4(cell_32)(gof__33):gof__33);};})(empty_1)(initGof_24);
   var newborn_28=Set.foldl(function(cell_34){
    return function(gof__35){
     return (eq(countNghb_7(cell_34)(initGof_24),3)?insert_4(cell_34)(gof__35):gof__35);};})(empty_1)(emptyCells_26);
   function survives_25(cell_29){
    return function(gof_30){
     return function(){
      var count_31=countNghb_7(cell_29)(gof_30);
      return (eq(count_31,2)||eq(count_31,3));}();};}
   return Set.union(survived_27)(newborn_28);}();}
 var alive_0=Set.member;
 var empty_1=Set.empty;
 var fromList_2=Set.fromList;
 var toList_3=Set.toList;
 var insert_4=Set.insert;
 var remove_5=Set.remove;
 var adjacentOffsets_6=['Cons',['Tuple2',-1,0],['Cons',['Tuple2',-1,-1],['Cons',['Tuple2',0,-1],['Cons',['Tuple2',1,-1],['Cons',['Tuple2',1,0],['Cons',['Tuple2',1,1],['Cons',['Tuple2',0,1],['Cons',['Tuple2',-1,1],['Nil']]]]]]]]];
 return {$op : {},
 alive:alive_0,
 empty:empty_1,
 fromList:fromList_2,
 toList:toList_3,
 insert:insert_4,
 remove:remove_5,
 step:step_9};}();
Elm.main=function(){
 return Elm.GameOfLife.main;};
} catch (e) {
Elm.main=function() {
var msg = ('<br/><h2>Your browser may not be supported. Are you using a modern browser?</h2>' + '<br/><span style="color:grey">Runtime Error in GameOfLife module:<br/>' + e + '</span>');
document.body.innerHTML = Elm.Text.monospace(msg);throw e;};}
try{

if (Elm.Main) throw "Module name collision, 'Main' is already defined.";
Elm.Main=function(){
 var $op={};
 for(Elm['i'] in Elm){eval('var '+Elm['i']+'=Elm[Elm.i];');}
 try{
  if (!(Elm.Prelude instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'Prelude' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var hiddenVars={};
 for (Elm['i'] in Elm.Prelude) {
  if (hiddenVars[Elm['i']]) continue;
  eval('var ' + Elm['i'] + ' = Elm.Prelude[Elm.i];');}
 try{
  if (!(Elm.Window instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'Window' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var dimensions=Elm.Window.dimensions;
 try{
  if (!(Elm.Mouse instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'Mouse' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var clicks=Elm.Mouse.clicks;
 var position=Elm.Mouse.position;
 try{
  if (!(Elm.Maybe instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'Maybe' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var mapMaybe=Elm.Maybe.mapMaybe;
 try{
  if (!(Elm.Time instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'Time' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var every=Elm.Time.every;
 try{
  if (!(Elm.Automaton instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'Automaton' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var hiddenVars={};
 for (Elm['i'] in Elm.Automaton) {
  if (hiddenVars[Elm['i']]) continue;
  eval('var ' + Elm['i'] + ' = Elm.Automaton[Elm.i];');}
 try{
  if (!(Elm.JavaScript instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'JavaScript' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var hiddenVars={};
 for (Elm['i'] in Elm.JavaScript) {
  if (hiddenVars[Elm['i']]) continue;
  eval('var ' + Elm['i'] + ' = Elm.JavaScript[Elm.i];');}
 try{
  if (!(Elm.JSON instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'JSON' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var JSON=Elm.JSON;
 try{
  if (!(Elm.HTTP instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'HTTP' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var sendGet=Elm.HTTP.sendGet;
 try{
  if (!(Elm.GameOfLife instanceof Object)) throw 'module not found';
 } catch(e) {
  throw ("Module 'GameOfLife' is missing. Compile with --make flag or load missing module in a separate JavaScript file.");
 }
 var GameOfLife=Elm.GameOfLife;
 var jsHost_3=Elm.Signal.constant(castStringToJSString(Value.str('')));
 Value.addListener(document, 'provideHost', function(e) { Dispatcher.notify(jsHost_3.id, e.value); });
 var presetUrl_4=Elm.Signal.constant(castStringToJSString(Value.str('')));
 Value.addListener(document, 'providePresetUrl', function(e) { Dispatcher.notify(presetUrl_4.id, e.value); });
 function repeat_0(a_25){
  return function(n_26){
   return map(function(__27){
    return a_25;})(function(){
    var lo=1;
    var hi=n_26;
    var lst=["Nil"];if(lo<=hi){do{lst=['Cons',hi,lst]}while(hi-->lo)}
    return lst;}());};}
 function placeholder_2(w_30){
  return function(h_31){
   return function(col_32){
    return function(text_33){
     return color(col_32)(container(w_30)(h_31)(middle)(plainText(text_33)));};};};}
 function getPoint_7(asocList_34){
  return function(){
  switch(asocList_34[0]){
   case 'Cons':
   switch(asocList_34[1][0]){
    case 'Tuple2':
    switch(asocList_34[1][2][0]){
     case 'JsonNumber':
     switch(asocList_34[2][0]){
      case 'Cons':
      switch(asocList_34[2][1][0]){
       case 'Tuple2':
       switch(asocList_34[2][1][2][0]){
        case 'JsonNumber':
        switch(asocList_34[2][2][0]){
         case 'Nil':
         return Just(['Tuple2',asocList_34[1][2][1],asocList_34[2][1][2][1]]);
        }break;
       }break;
      }break;
     }break;
    }break;
   }break;
  }
  return Nothing;}();}
 function getValue_8(obj_37){
  return function(){
  switch(obj_37[0]){
   case 'JsonObject':
   return obj_37[1];
  }
  return JSON.empty;}();}
 function handleResponse_9(res_39){
  return function(){
  switch(res_39[0]){
   case 'Failure':
   return JSON.empty;
   case 'Success':
   return JSON.fromString(res_39[1]);
   case 'Waiting':
   return JSON.empty;
  }
  throw "Non-exhaustive pattern match in case";}();}
 function gofCell_16(w_54){
  return function(h_55){
   return function(Tuple2$xy_56){
    return function(){
    switch(Tuple2$xy_56[0]){
     case 'Tuple2':
     return filled(rgb(255)(102)(0))(rect(w_54)(h_55)(['Tuple2',Tuple2$xy_56[1],Tuple2$xy_56[2]]));
    }
    throw "Non-exhaustive pattern match in case";}();};};}
 function noCell_17(w_59){
  return function(h_60){
   return function(Tuple2$xy_61){
    return function(){
    switch(Tuple2$xy_61[0]){
     case 'Tuple2':
     return filled(rgb(64)(64)(64))(rect(w_59)(h_60)(['Tuple2',Tuple2$xy_61[1],Tuple2$xy_61[2]]));
    }
    throw "Non-exhaustive pattern match in case";}();};};}
 function synthCtrl_18(w_64){
  return function(h_65){
   return placeholder_2(w_64)(h_65)(blue)(Value.str('Sythesizer controls'));};}
 function golCtrl_19(w_66){
  return function(h_67){
   return placeholder_2(w_66)(h_67)(rgb(56)(56)(56))(Value.str('GoL controls'));};}
 function presets_20(w_68){
  return function(h_69){
   return placeholder_2(w_68)(h_69)(rgb(56)(56)(56))(Value.str('Presets'));};}
 function sequencer_21(w_70){
  return function(h_71){
   return function(){
    var steps_72=16;
    var cellSize_73=(toFloat(w_70)/steps_72);
    var grid_75=concatMap(function(c_78){
     return zip(repeat_0(c_78)(steps_72))(map(coordinate_74)(function(){
      var lo=1;
      var hi=steps_72;
      var lst=["Nil"];if(lo<=hi){do{lst=['Cons',hi,lst]}while(hi-->lo)}
      return lst;}()));})(map(coordinate_74)(function(){
     var lo=1;
     var hi=steps_72;
     var lst=["Nil"];if(lo<=hi){do{lst=['Cons',hi,lst]}while(hi-->lo)}
     return lst;}()));
    var inactiveCells_76=map(noCell_17((cellSize_73*0.8))((cellSize_73*0.8)))(grid_75);
    function coordinate_74(x_77){
     return ((cellSize_73*toFloat(x_77))-(cellSize_73*0.5));}
    return lift(function(activeCells_79){
     return collage(w_70)(h_71)(Value.append(inactiveCells_76,map(gofCell_16((cellSize_73*0.8))((cellSize_73*0.8)))(map(function(Tuple2$xy_80){
      return function(){
      switch(Tuple2$xy_80[0]){
       case 'Tuple2':
       return ['Tuple2',coordinate_74(Tuple2$xy_80[1]),coordinate_74(Tuple2$xy_80[2])];
      }
      throw "Non-exhaustive pattern match in case";}();})(activeCells_79))));})(mainGol_14);}();};}
 function percent_22(x_83){
  return function(p_84){
   return div((x_83*p_84))(100);};}
 function view_23(Tuple2$wh_85){
  return function(seqView_86){
   return function(pattern_87){
    return function(){
    switch(Tuple2$wh_85[0]){
     case 'Tuple2':
     return function(){
      var layout_w_90=div((5*Tuple2$wh_85[1]))(6);
      var game_h_91=div((3*Tuple2$wh_85[2]))(5);
      return container(Tuple2$wh_85[1])(Tuple2$wh_85[2])(middle)(color(grey)(above(above(container(layout_w_90)(game_h_91)(middle)(flow(right)(['Cons',golCtrl_19(percent_22(layout_w_90)(12))(percent_22(game_h_91)(80)),['Cons',seqView_86,['Cons',presets_20(percent_22(layout_w_90)(12))(percent_22(game_h_91)(80)),['Nil']]]])))(synthCtrl_18(layout_w_90)(div(Tuple2$wh_85[2])(6))))(asText(pattern_87))));}();
    }
    throw "Non-exhaustive pattern match in case";}();};};}
 var clickLocations_1=foldp(function(x_28){
  return function(y_29){
   return ['Cons',x_28,y_29];};})(['Nil'])(sampleOn(clicks)(position));
 var host_5=lift(castJSStringToString)(jsHost_3);
 var presetSignal_6=sendGet(lift(castJSStringToString)(presetUrl_4));
 var patternSignal_10=lift(function(preset_41){
  return mapMaybe(function(obj_42){
   return getPoint_7(JSON.toList(getValue_8(obj_42)));})(JSON.findArray(Value.str('pattern'))(handleResponse_9(preset_41)));})(presetSignal_6);
 var exploder_11=['Cons',['Tuple2',8,8],['Cons',['Tuple2',7,9],['Cons',['Tuple2',8,9],['Cons',['Tuple2',9,9],['Cons',['Tuple2',7,10],['Cons',['Tuple2',9,10],['Cons',['Tuple2',8,11],['Nil']]]]]]]];
 var cycleExploder_12=['Cons',['Tuple2',8,8],['Cons',['Tuple2',8,12],['Cons',['Tuple2',6,8],['Cons',['Tuple2',6,9],['Cons',['Tuple2',6,10],['Cons',['Tuple2',6,11],['Cons',['Tuple2',6,12],['Cons',['Tuple2',10,8],['Cons',['Tuple2',10,9],['Cons',['Tuple2',10,10],['Cons',['Tuple2',10,11],['Cons',['Tuple2',10,12],['Nil']]]]]]]]]]]]];
 var golAutomaton_13=function(){
  var gol_44=GameOfLife.fromList(cycleExploder_12);
  function fstep_43(input_45){
   return function(stateGol_46){
    return function(){
     var gol_47=function(){
     switch(input_45[0]){
      case 'Nil':
      return stateGol_46;
     }
     return GameOfLife.fromList(input_45);}();
     var out_48=GameOfLife.step(gol_47);
     return ['Tuple2',GameOfLife.toList(out_48),out_48];}();};}
  return init_(gol_44)(fstep_43);}();
 var mainGol_14=run(golAutomaton_13)(merge(patternSignal_10)(lift(function(__49){
  return ['Nil'];})(every(500))));
 var exportGol_15=lift(function(gol_50){
  return castListToJSArray(map(function(Tuple2$xy_51){
   return function(){
   switch(Tuple2$xy_51[0]){
    case 'Tuple2':
    return castTupleToJSTuple2(['Tuple2',castIntToJSNumber(Tuple2$xy_51[1]),castIntToJSNumber(Tuple2$xy_51[2])]);
   }
   throw "Non-exhaustive pattern match in case";}();})(gol_50));})(mainGol_14);
 var main_24=lift3(view_23)(dimensions)(sequencer_21(400)(400))(patternSignal_10);
 lift(function(v) { var e = document.createEvent('Event');e.initEvent('onGolStep', true, true);e.value = v;document.dispatchEvent(e); return v; })(exportGol_15);
 return {$op : {},
 repeat:repeat_0,
 clickLocations:clickLocations_1,
 placeholder:placeholder_2,
 jsHost:jsHost_3,
 presetUrl:presetUrl_4,
 host:host_5,
 presetSignal:presetSignal_6,
 getPoint:getPoint_7,
 getValue:getValue_8,
 handleResponse:handleResponse_9,
 patternSignal:patternSignal_10,
 exploder:exploder_11,
 cycleExploder:cycleExploder_12,
 golAutomaton:golAutomaton_13,
 mainGol:mainGol_14,
 exportGol:exportGol_15,
 gofCell:gofCell_16,
 noCell:noCell_17,
 synthCtrl:synthCtrl_18,
 golCtrl:golCtrl_19,
 presets:presets_20,
 sequencer:sequencer_21,
 percent:percent_22,
 view:view_23,
 main:main_24};}();
Elm.main=function(){
 return Elm.Main.main;};
} catch (e) {
Elm.main=function() {
var msg = ('<br/><h2>Your browser may not be supported. Are you using a modern browser?</h2>' + '<br/><span style="color:grey">Runtime Error in Main module:<br/>' + e + '<br/><br/>The problem may stem from an improper usage of:<br/>Failure, GameOfLife.fromList, GameOfLife.step, GameOfLife.toList, JSON.empty, JsonNumber, JsonObject, Success, Waiting, above, clicks, dimensions, every, mapMaybe, position, sendGet</span>');
document.body.innerHTML = Elm.Text.monospace(msg);throw e;};}</script><div id="widthChecker" style="width:100%; height:1px; position:absolute; top:-1px;"></div><div id="content"></div><script type="text/javascript">Dispatcher.initialize()</script><noscript><p>pattern</p><p>Sythesizer controls</p><p>GoL controls</p><p>Presets</p></noscript></body></html>